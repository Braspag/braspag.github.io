<!DOCTYPE html>
<html>
<head>
    <title>Authorization with Authentication</title>
    
        <meta http-equiv="refresh" content="0; url=https://docs.cielo.com.br/gateway-en/docs/what-is-3ds-22-authentication">
        <link rel="canonical" href="https://docs.cielo.com.br/gateway-en/docs/what-is-3ds-22-authentication" />
    
</head>
<body>
    <h1>Authorization with Authentication</h1>
    <h3> Redirecionando para <a href="https://docs.cielo.com.br/gateway-en/docs/what-is-3ds-22-authentication">https://docs.cielo.com.br/gateway-en/docs/what-is-3ds-22-authentication</a> ...</h3>
    <script>location='https://docs.cielo.com.br/gateway-en/docs/what-is-3ds-22-authentication'</script>
    <h1 id="authorization-with-authentication">Authorization with Authentication</h1>

<p>After authentication is completed, the transaction undergoes the authorization process by submitting the authentication data in the “external authentication” (node <strong>ExternalAuthentication</strong>).
This procedure is also valid for establishments that performed authentication outside Cielo (External MPI).</p>

<p>For more details about 3DS 2.0, please visit: <a href="https://braspag.github.io//en/manualp/emv3ds" target="_blank">https://braspag.github.io//en/manualp/emv3ds</a></p>

<p>See example below, describing the submission of authentication data from the Pagador API authorization request.</p>

<aside class="request"><span class="method post">POST</span> <span class="endpoint">/v2/sales</span></aside>

<h3 id="request">Request</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"MerchantOrderId"</span><span class="p">:</span><span class="s2">"2017051002"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"Customer"</span><span class="p">:</span><span class="w">
   </span><span class="p">{</span><span class="w">
     </span><span class="err">(...)</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"Payment"</span><span class="p">:</span><span class="w">
   </span><span class="p">{</span><span class="w">
     </span><span class="err">(...)</span><span class="w">
     </span><span class="nl">"Provider"</span><span class="p">:</span><span class="s2">"Cielo30"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"Authenticate"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
     </span><span class="nl">"ReturnUrl"</span><span class="p">:</span><span class="s2">"http://www.loja.com.br"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"CreditCard"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"CardNumber"</span><span class="p">:</span><span class="s2">"4000000000001000"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"Holder"</span><span class="p">:</span><span class="s2">"Nome do Portador"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ExpirationDate"</span><span class="p">:</span><span class="s2">"12/2021"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SecurityCode"</span><span class="p">:</span><span class="s2">"123"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"Visa"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaveCard"</span><span class="p">:</span><span class="s2">"false"</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"ExternalAuthentication"</span><span class="p">:{</span><span class="w">
       </span><span class="nl">"Cavv"</span><span class="p">:</span><span class="s2">"AAABB2gHA1B5EFNjWQcDAAAAAAB="</span><span class="p">,</span><span class="w">
       </span><span class="nl">"Xid"</span><span class="p">:</span><span class="s2">"Uk5ZanBHcWw2RjRCbEN5dGtiMTB="</span><span class="p">,</span><span class="w">
       </span><span class="nl">"Eci"</span><span class="p">:</span><span class="s2">"5"</span><span class="p">,</span><span class="w">
       </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"2"</span><span class="p">,</span><span class="w">
       </span><span class="nl">"ReferenceID"</span><span class="p">:</span><span class="s2">"a24a5d87-b1a1-4aef-a37b-2f30b91274e6"</span><span class="w">
     </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl
<span class="nt">--request</span> POST <span class="s2">"https://apisandbox.braspag.com.br/v2/sales"</span>
<span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span>
<span class="nt">--header</span> <span class="s2">"MerchantId: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
<span class="nt">--header</span> <span class="s2">"MerchantKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
<span class="nt">--data-binary</span>
<span class="nt">--verbose</span>
<span class="o">{</span>
   <span class="s2">"MerchantOrderId"</span>:<span class="s2">"2017051002"</span>,
   <span class="s2">"Customer"</span>:
   <span class="o">{</span>
     <span class="o">(</span>...<span class="o">)</span>
   <span class="o">}</span>,
   <span class="s2">"Payment"</span>:
   <span class="o">{</span>
     <span class="o">(</span>...<span class="o">)</span>
     <span class="s2">"Provider"</span>:<span class="s2">"Cielo30"</span>,
     <span class="s2">"Authenticate"</span>:true,
     <span class="s2">"ReturnUrl"</span>:<span class="s2">"http://www.loja.com.br"</span>,
     <span class="s2">"CreditCard"</span>:<span class="o">{</span>
         <span class="s2">"CardNumber"</span>:<span class="s2">"4000000000001000"</span>,
         <span class="s2">"Holder"</span>:<span class="s2">"Nome do Portador"</span>,
         <span class="s2">"ExpirationDate"</span>:<span class="s2">"12/2021"</span>,
         <span class="s2">"SecurityCode"</span>:<span class="s2">"123"</span>,
         <span class="s2">"Brand"</span>:<span class="s2">"Visa"</span>,
         <span class="s2">"SaveCard"</span>:<span class="s2">"false"</span>
     <span class="o">}</span>,
     <span class="s2">"ExternalAuthentication"</span>:<span class="o">{</span>
       <span class="s2">"Cavv"</span>:<span class="s2">"AAABB2gHA1B5EFNjWQcDAAAAAAB="</span>,
       <span class="s2">"Xid"</span>:<span class="s2">"Uk5ZanBHcWw2RjRCbEN5dGtiMTB="</span>,
       <span class="s2">"Eci"</span>:<span class="s2">"5"</span>,
       <span class="s2">"Version"</span>:<span class="s2">"2"</span>,
       <span class="s2">"ReferenceID"</span>:<span class="s2">"a24a5d87-b1a1-4aef-a37b-2f30b91274e6"</span>
     <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>Field</strong></th>
      <th><strong>Description</strong></th>
      <th><strong>Type/Size</strong></th>
      <th><strong>Required</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.Provider</code></td>
      <td>Name of payment method provider: Cielo30, Getnet or Rede</td>
      <td>Text / 15</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.Authenticate</code></td>
      <td>Defines if the buyer will be directed to the issuing Bank for card authentication</td>
      <td>Boolean (true or false)</td>
      <td>Yes, when authentication was a success</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.ReturnUrl</code></td>
      <td>Return URL only applicable if version is “1”</td>
      <td>Alphanumeric [1024 positions]</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.Cavv</code></td>
      <td>Signature that is returned in successful authentication scenarios</td>
      <td>Text</td>
      <td>Yes, when authentication was a success</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.Xid</code></td>
      <td>XID returned in authentication process</td>
      <td>Text</td>
      <td>Yes, when the 3DS version is “1”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.Eci</code></td>
      <td>E-commerce Indicator Returned in Authentication Process</td>
      <td>Numeric [1 position]</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.Version</code></td>
      <td>3DS version used in authentication process</td>
      <td>Alphanumeric [1 position]</td>
      <td>Yes, when the version of 3DS is “2”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.ReferenceID</code></td>
      <td>RequestID Returned in Authentication Process</td>
      <td>GUID [36 positions]</td>
      <td>Yes, when the version of 3DS is “2”</td>
    </tr>
  </tbody>
</table>

<h3 id="response">Response</h3>

<p>See response at <a href="https://braspag.github.io//en/manual/braspag-pagador#authenticating-a-transaction" target="_blank">API REST Integration Guide</a></p>

<h1 id="authorization-for-data-only-transactions">Authorization for Data Only Transactions</h1>

<p>After the authentication step in Data Only model is completed (field <code class="language-plaintext highlighter-rouge">bpmpi_auth_notifyonly</code> set as “true”), the transaction undergoes the authorization process by sending the authentication data in the “external authentication” model (node <code class="language-plaintext highlighter-rouge">ExternalAuthentication</code>).
See example below, describing the submission of authentication data from the Pagador API authorization request, using POST:</p>

<h3 id="request-1">Request</h3>

<aside class="request"><span class="method post">POST</span> <span class="endpoint">/v2/sales</span></aside>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">  
   </span><span class="nl">"MerchantOrderId"</span><span class="p">:</span><span class="s2">"2017051002"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"Customer"</span><span class="p">:</span><span class="w">
   </span><span class="p">{</span><span class="w">  
     </span><span class="err">(...)</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"Payment"</span><span class="p">:</span><span class="w">
   </span><span class="p">{</span><span class="w">  
     </span><span class="err">(...)</span><span class="w">
     </span><span class="nl">"Authenticate"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
     </span><span class="nl">"ReturnUrl"</span><span class="p">:</span><span class="s2">"http://www.loja.com.br"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"CreditCard"</span><span class="p">:{</span><span class="w">  
         </span><span class="nl">"CardNumber"</span><span class="p">:</span><span class="s2">"4000000000001000"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"Holder"</span><span class="p">:</span><span class="s2">"Nome do Portador"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ExpirationDate"</span><span class="p">:</span><span class="s2">"12/2021"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SecurityCode"</span><span class="p">:</span><span class="s2">"123"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"Visa"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaveCard"</span><span class="p">:</span><span class="s2">"false"</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"ExternalAuthentication"</span><span class="p">:{</span><span class="w">
       </span><span class="nl">"Eci"</span><span class="p">:</span><span class="s2">"4"</span><span class="p">,</span><span class="w">
       </span><span class="nl">"ReferenceID"</span><span class="p">:</span><span class="s2">"a24a5d87-b1a1-4aef-a37b-2f30b91274e6"</span><span class="p">,</span><span class="w">
       </span><span class="nl">"dataonly"</span><span class="p">:</span><span class="kc">true</span><span class="w">
     </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--request</span> POST <span class="s2">"https://apisandbox.cieloecommerce.cielo.com.br/1/sales"</span>
<span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span>
<span class="nt">--header</span> <span class="s2">"MerchantId: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
<span class="nt">--header</span> <span class="s2">"MerchantKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
<span class="nt">--data-binary</span>
<span class="nt">--verbose</span>
<span class="o">{</span>  
   <span class="s2">"MerchantOrderId"</span>:<span class="s2">"2017051002"</span>,
   <span class="s2">"Customer"</span>:
   <span class="o">{</span>  
     <span class="o">(</span>...<span class="o">)</span>
   <span class="o">}</span>,
   <span class="s2">"Payment"</span>:
   <span class="o">{</span>  
     <span class="o">(</span>...<span class="o">)</span>
     <span class="s2">"Authenticate"</span>:false,
     <span class="s2">"ReturnUrl"</span>:<span class="s2">"http://www.loja.com.br"</span>,
     <span class="s2">"CreditCard"</span>:<span class="o">{</span>  
         <span class="s2">"CardNumber"</span>:<span class="s2">"4000000000001000"</span>,
         <span class="s2">"Holder"</span>:<span class="s2">"Nome do Portador"</span>,
         <span class="s2">"ExpirationDate"</span>:<span class="s2">"12/2021"</span>,
         <span class="s2">"SecurityCode"</span>:<span class="s2">"123"</span>,
         <span class="s2">"Brand"</span>:<span class="s2">"Visa"</span>,
         <span class="s2">"SaveCard"</span>:<span class="s2">"false"</span>
     <span class="o">}</span>,
     <span class="s2">"ExternalAuthentication"</span>:<span class="o">{</span>
       <span class="s2">"Eci"</span>:<span class="s2">"4"</span>,
       <span class="s2">"ReferenceID"</span>:<span class="s2">"a24a5d87-b1a1-4aef-a37b-2f30b91274e6"</span>,
       <span class="s2">"dataonly"</span>:true
     <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>FIELD</strong></th>
      <th><strong>DESCRIPTION</strong></th>
      <th><strong>TYPE/SIZE</strong></th>
      <th><strong>REQUIRED</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.Authenticate</code></td>
      <td>Defines if the buyer will be directed to the issuing Bank for card authentication</td>
      <td>Boolean (true or false)</td>
      <td>Yes. For Data Only transactions the value must be “false”</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.Eci</code></td>
      <td><em>E-commerce Indicator</em> returned in authentication process</td>
      <td>Numeric [1 position]</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.ReferenceId</code></td>
      <td>RequestID returned in authentication process</td>
      <td>GUID [36 positions]</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.DataOnly</code></td>
      <td>Defines if transaction is <em>Data Only</em></td>
      <td>Boolean (true or false)</td>
      <td>Yes. For Data Only transactions the value must be “true”</td>
    </tr>
  </tbody>
</table>

<h3 id="response-1">Response</h3>

<p>See <a href="https://braspag.github.io//en/manualp/authorization-with-authentication?json#authorization-with-authentication">API Rest Integration Guide</a> for detailed examples of Authorization with Authentication response.</p>

<h1 id="eci-table">ECI Table</h1>

<p>The Electronic Commerce Indicator (ECI) is a code returned by the card brands indicating the 3DS card holder authentication result. The table below presents the ECI codes corresponding to each brand and the authentication result.</p>

<blockquote>
  <p>The ECI value received during authentication must later be sent in the authorization request in the parameter <code class="language-plaintext highlighter-rouge">Payment.ExternalAuthentication.Eci</code>.</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>Mastercard</th>
      <th>Visa</th>
      <th>Elo</th>
      <th>Amex</th>
      <th>Authentication Result</th>
      <th>Transaction was authenticated?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>02</td>
      <td>05</td>
      <td>05</td>
      <td>05</td>
      <td>Authenticated by the issuer – chargeback liability is held by the issuer.</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>01</td>
      <td>06</td>
      <td>06</td>
      <td>06</td>
      <td>Authenticated by the card brand – chargeback liability is held by the issue.</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>Different from 01, 02 or 04</td>
      <td>Different from 05 or 06</td>
      <td>Different from 05 or 06</td>
      <td>Different from 05 or 06</td>
      <td>Non-authenticated – chargeback liability is held by the merchant.</td>
      <td>No</td>
    </tr>
    <tr>
      <td>04</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Non-authenticated, <em>Data Only</em> transaction – chargeback liability is held by the merchant</td>
      <td>No</td>
    </tr>
  </tbody>
</table>

</body>
</html>